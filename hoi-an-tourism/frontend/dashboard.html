<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√†i Kho·∫£n C·ªßa T√¥i - Khu Sinh Th√°i Nh√† T√¥i</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 120px auto 50px;
            padding: 2rem;
        }
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .dashboard-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
        }
        .dashboard-header p {
            margin: 0;
            opacity: 0.9;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card h3 {
            font-size: 2.5rem;
            margin: 0 0 0.5rem 0;
            color: #667eea;
        }
        .stat-card p {
            margin: 0;
            color: #666;
        }
        .bookings-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .bookings-section h2 {
            color: #2c3e50;
            margin: 0 0 1.5rem 0;
            font-size: 1.8rem;
        }
        .booking-card {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        .booking-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }
        .booking-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }
        .booking-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .status-pending {
            background: #f39c12;
            color: white;
        }
        .status-confirmed {
            background: #27ae60;
            color: white;
        }
        .status-cancelled {
            background: #e74c3c;
            color: white;
        }
        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        .detail-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 0.3rem;
        }
        .detail-value {
            font-size: 1rem;
            color: #2c3e50;
            font-weight: 500;
        }
        .payment-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .payment-info h4 {
            color: #856404;
            margin: 0 0 0.8rem 0;
            font-size: 1.1rem;
        }
        .payment-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f0e68c;
        }
        .payment-row:last-child {
            border-bottom: none;
            font-size: 1.2rem;
            font-weight: bold;
            color: #e74c3c;
        }
        .payment-status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-left: 10px;
        }
        .payment-unpaid {
            background: #e74c3c;
            color: white;
        }
        .payment-paid {
            background: #27ae60;
            color: white;
        }
        .no-bookings {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }
        .no-bookings i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        .loading {
            text-align: center;
            padding: 3rem;
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html" style="text-decoration: none;">
                    <h2>üè° Nh√† T√¥i - H√≤a B√¨nh</h2>
                </a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Trang ch·ªß</a></li>
                <li class="nav-item"><a href="hotels.html" class="nav-link">Kh√°ch s·∫°n</a></li>
                <li class="nav-item"><a href="attractions.html" class="nav-link">ƒêi·ªÉm tham quan</a></li>
                <li class="nav-item"><a href="restaurant.html" class="nav-link">Nh√† h√†ng</a></li>
                <li class="nav-item"><a href="news.html" class="nav-link">Tin t·ª©c</a></li>
                <li class="nav-item"><a href="about-us.html" class="nav-link">V·ªÅ ch√∫ng t√¥i</a></li>
                <li class="nav-item" id="auth-nav">
                    <a href="#" class="nav-link" onclick="checkAuth()">üë§ T√†i kho·∫£n</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1>üëã Xin ch√†o, <span id="userName">...</span></h1>
            <p>Qu·∫£n l√Ω ƒë·∫∑t ph√≤ng v√† th√¥ng tin t√†i kho·∫£n c·ªßa b·∫°n</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalBookings">0</h3>
                <p>üìã T·ªïng ƒë·∫∑t ph√≤ng</p>
            </div>
            <div class="stat-card">
                <h3 id="pendingBookings">0</h3>
                <p>‚è≥ Ch·ªù x√°c nh·∫≠n</p>
            </div>
            <div class="stat-card">
                <h3 id="confirmedBookings">0</h3>
                <p>‚úÖ ƒê√£ x√°c nh·∫≠n</p>
            </div>
        </div>

        <!-- Bookings List -->
        <div class="bookings-section">
            <h2>üìö Danh S√°ch ƒê·∫∑t Ph√≤ng</h2>
            <div id="bookingsList" class="loading">
                ƒêang t·∫£i d·ªØ li·ªáu...
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:3000';

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (!token || !user) {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem th√¥ng tin t√†i kho·∫£n');
                window.location.href = 'index.html';
                return;
            }

            const userData = JSON.parse(user);
            document.getElementById('userName').textContent = userData.username;
            
            loadUserBookings();
        });

        // Load user bookings
        async function loadUserBookings() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE_URL}/api/bookings`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë·∫∑t ph√≤ng');
                }

                const bookings = await response.json();
                displayBookings(bookings);
                updateStats(bookings);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('bookingsList').innerHTML = `
                    <div class="no-bookings">
                        ‚ùå L·ªói: ${error.message}
                    </div>
                `;
            }
        }

        // Display bookings
        function displayBookings(bookings) {
            const container = document.getElementById('bookingsList');
            
            if (bookings.length === 0) {
                container.innerHTML = `
                    <div class="no-bookings">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
                        <h3>Ch∆∞a c√≥ ƒë·∫∑t ph√≤ng n√†o</h3>
                        <p>H√£y kh√°m ph√° c√°c kh√°ch s·∫°n c·ªßa ch√∫ng t√¥i!</p>
                        <a href="hotels.html" style="display: inline-block; margin-top: 1rem; padding: 0.8rem 2rem; background: #667eea; color: white; text-decoration: none; border-radius: 5px;">
                            Xem Kh√°ch S·∫°n
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = bookings.map(booking => {
                const depositAmount = booking.deposit_amount || (booking.total_price * 0.5);
                const remainingAmount = booking.total_price - depositAmount;
                
                return `
                    <div class="booking-card">
                        <div class="booking-header">
                            <div class="booking-id">üìã M√£: #${booking.id}</div>
                            <span class="booking-status status-${booking.status}">
                                ${getStatusName(booking.status)}
                            </span>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-item">
                                <span class="detail-label">üè® Kh√°ch s·∫°n</span>
                                <span class="detail-value">${booking.hotel_name}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üõèÔ∏è Lo·∫°i ph√≤ng</span>
                                <span class="detail-value">${booking.room_type}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üî¢ S·ªë ph√≤ng</span>
                                <span class="detail-value">${booking.num_rooms || 1} ph√≤ng</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üë• S·ªë kh√°ch</span>
                                <span class="detail-value">${booking.guests} ng∆∞·ªùi</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üìÖ Nh·∫≠n ph√≤ng</span>
                                <span class="detail-value">${formatDate(booking.checkin_date)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üìÖ Tr·∫£ ph√≤ng</span>
                                <span class="detail-value">${formatDate(booking.checkout_date)}</span>
                            </div>
                        </div>
                        
                        <div class="payment-info">
                            <h4>üí∞ Th√¥ng tin thanh to√°n 
                                <span class="payment-status-badge payment-${booking.payment_status || 'unpaid'}">
                                    ${booking.payment_status === 'paid' ? '‚úì ƒê√£ thanh to√°n' : '‚ö†Ô∏è Ch∆∞a thanh to√°n'}
                                </span>
                            </h4>
                            <div class="payment-row">
                                <span>T·ªïng gi√°:</span>
                                <span>${booking.total_price.toLocaleString('vi-VN')} VNƒê</span>
                            </div>
                            <div class="payment-row">
                                <span>Ti·ªÅn ƒë·∫∑t c·ªçc (50%):</span>
                                <span style="color: #e74c3c; font-weight: bold;">${depositAmount.toLocaleString('vi-VN')} VNƒê</span>
                            </div>
                            <div class="payment-row">
                                <span>Thanh to√°n t·∫°i kh√°ch s·∫°n:</span>
                                <span style="color: #27ae60;">${remainingAmount.toLocaleString('vi-VN')} VNƒê</span>
                            </div>
                        </div>
                        
                        ${booking.special_requests ? `
                            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
                                <strong>üìù Y√™u c·∫ßu ƒë·∫∑c bi·ªát:</strong><br>
                                ${booking.special_requests}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Update statistics
        function updateStats(bookings) {
            const total = bookings.length;
            const pending = bookings.filter(b => b.status === 'pending').length;
            const confirmed = bookings.filter(b => b.status === 'confirmed').length;

            document.getElementById('totalBookings').textContent = total;
            document.getElementById('pendingBookings').textContent = pending;
            document.getElementById('confirmedBookings').textContent = confirmed;
        }

        // Helper functions
        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getStatusName(status) {
            const names = {
                'pending': '‚è≥ Ch·ªù x√°c nh·∫≠n',
                'confirmed': '‚úÖ ƒê√£ x√°c nh·∫≠n',
                'cancelled': '‚ùå ƒê√£ h·ªßy'
            };
            return names[status] || status;
        }
    </script>
</body>
</html>
